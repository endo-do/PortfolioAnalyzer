<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>{% block title %}Portfolio Analyzer{% endblock %}</title>
  
  <!-- Bootstrap CSS -->
  <link href="{{ config.BOOTSTRAP_CSS_URL }}" rel="stylesheet" />
  
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="{{ config.FONT_AWESOME_CSS_URL }}" />

  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">

  {% block extra_css %}{% endblock %}
</head>
<body>
  
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light mb-4">
  <div class="container-fluid d-flex flex-column align-items-start">
    <div class="d-flex justify-content-between w-100 align-items-center">
      <div></div>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>

    <div class="collapse navbar-collapse w-100" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        {% block navbar_links %}
        <!-- Add your nav links here -->
        {% endblock %}
      </ul>
    </div>

    <!-- Breadcrumb Navigation -->
    <div class="mt-2 w-100">
      {% block breadcrumb %}
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item">
            <a href="{{ url_for('main.home') }}" class="text-decoration-none">
              <i class="fas fa-home me-1"></i>Home
            </a>
          </li>
          {% block breadcrumb_items %}{% endblock %}
        </ol>
      </nav>
      {% endblock %}
    </div>

    <!-- New block for under-brand content like back button -->
    <div class="mt-2 w-100">
      {% block navbar_subcontent %}{% endblock %}
    </div>
  </div>
</nav>
  
  <!-- Main content -->
  <main class="container-fluid mb-5">
    
    <!-- Modern Notification System -->
    <div id="notificationContainer" class="position-fixed" style="top: 20px; right: 20px; z-index: 1050; max-width: 400px;">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="notification alert-{{ category }} mb-3" role="alert">
              <div class="d-flex align-items-center">
                <div class="notification-icon me-3">
                  {% if category == 'success' %}
                    <i class="fas fa-check-circle"></i>
                  {% elif category == 'danger' %}
                    <i class="fas fa-exclamation-circle"></i>
                  {% elif category == 'warning' %}
                    <i class="fas fa-exclamation-triangle"></i>
                  {% elif category == 'info' %}
                    <i class="fas fa-info-circle"></i>
                  {% else %}
                    <i class="fas fa-bell"></i>
                  {% endif %}
                </div>
                <div class="flex-grow-1">
                  <div class="notification-message">{{ message }}</div>
                </div>
                <button type="button" class="btn-close-notification" aria-label="Close">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <div class="notification-progress"></div>
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}
    </div>
    
    <!-- CSRF Token for AJAX requests -->
    <meta name="csrf-token" content="{{ csrf_token() }}">
    
    {% block content %}
    <!-- Content goes here -->
    {% endblock %}
  </main>
  
  <!-- Footer -->
  <footer class="bg-light py-3 mt-auto">
    <div class="container-fluid text-center">
      <small>&copy; Portfolio Analyzer. All rights reserved.</small>
    </div>
  </footer>
  
  <!-- Bootstrap JS Bundle with Popper -->
  <script src="{{ config.BOOTSTRAP_JS_URL }}"></script>
  
  <script>
    // Make config values available to JavaScript
    window.API_TIMEOUT_SECONDS = {{ config.API_TIMEOUT_SECONDS }};
    window.UI_TIMEOUT_MS = {{ config.UI_TIMEOUT_MS }};
    window.UI_UPDATE_DELAY_MS = {{ config.UI_UPDATE_DELAY_MS }};
    window.YAHOO_FINANCE_BASE_URL = "{{ config.YAHOO_FINANCE_BASE_URL }}";
    window.YAHOO_FINANCE_QUOTE_URL = "{{ config.YAHOO_FINANCE_QUOTE_URL }}";
    window.YAHOO_FINANCE_LOOKUP_URL = "{{ config.YAHOO_FINANCE_LOOKUP_URL }}";
    
    document.addEventListener('DOMContentLoaded', () => {
      // Modal cleanup
      document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('hidden.bs.modal', () => {
          const instance = bootstrap.Modal.getInstance(modal);
          if (instance) instance.dispose(); // clear internal state
          modal.querySelectorAll('form').forEach(form => form.reset());
        });
      });

      // Modern Notification System
      const notifications = document.querySelectorAll('.notification');
      
      notifications.forEach((notification, index) => {
        // Show notification with staggered delay
        setTimeout(() => {
          notification.classList.add('show');
        }, index * 100);

        // Auto-dismiss after 5 seconds
        setTimeout(() => {
          dismissNotification(notification);
        }, window.UI_TIMEOUT_MS);

        // Manual dismiss button
        const closeBtn = notification.querySelector('.btn-close-notification');
        if (closeBtn) {
          closeBtn.addEventListener('click', () => {
            dismissNotification(notification);
          });
        }
      });

      function dismissNotification(notification) {
        notification.style.transform = 'translateX(100%)';
        notification.style.opacity = '0';
        
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 400);
      }

      // Global function to show new notifications (for future use)
      window.showNotification = function(message, type = 'info') {
        const container = document.getElementById('notificationContainer');
        const notification = document.createElement('div');
        notification.className = `notification alert-${type} mb-3`;
        notification.setAttribute('role', 'alert');
        
        const iconMap = {
          success: 'fas fa-check-circle',
          danger: 'fas fa-exclamation-circle',
          warning: 'fas fa-exclamation-triangle',
          info: 'fas fa-info-circle'
        };
        
        notification.innerHTML = `
          <div class="d-flex align-items-center">
            <div class="notification-icon me-3">
              <i class="${iconMap[type] || 'fas fa-bell'}"></i>
            </div>
            <div class="flex-grow-1">
              <div class="notification-message">${message}</div>
            </div>
            <button type="button" class="btn-close-notification" aria-label="Close">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="notification-progress"></div>
        `;
        
        container.appendChild(notification);
        
        // Show notification
        setTimeout(() => {
          notification.classList.add('show');
        }, 100);
        
        // Auto-dismiss
        setTimeout(() => {
          dismissNotification(notification);
        }, window.UI_TIMEOUT_MS);
        
        // Manual dismiss
        const closeBtn = notification.querySelector('.btn-close-notification');
        closeBtn.addEventListener('click', () => {
          dismissNotification(notification);
        });
      };
    });
  </script>

  {% block extra_js %}{% endblock %}
</body>
</html>